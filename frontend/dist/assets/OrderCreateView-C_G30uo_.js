import{d as S,r as i,b as E,c as O,f as t,w as r,h as s,a as d,t as R,g,E as n,u as h,l as L,o as T,_ as z}from"./index-CP6BfJf4.js";import{u as I}from"./order-CJPQCLK0.js";const A={class:"order-create"},D={class:"total-price"},F=S({__name:"OrderCreateView",setup(H){const _=h(),b=I(),m=i(),l=i({customerName:"",productName:"",quantity:1,unitPrice:0,files:[],notes:""}),V={Authorization:`Bearer ${localStorage.getItem("token")}`},p=i(!1),y=i({customerName:[{required:!0,message:"请输入客户名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],productName:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],quantity:[{required:!0,message:"请输入数量",trigger:"blur"},{type:"number",min:1,message:"数量必须大于0",trigger:"blur"}],unitPrice:[{required:!0,message:"请输入单价",trigger:"blur"},{type:"number",min:0,message:"单价不能为负数",trigger:"blur"}]}),x=E(()=>l.value.quantity*l.value.unitPrice),N=u=>u.size/1024/1024<10?!0:(n.error("文件大小不能超过 10MB!"),!1),q=(u,e)=>{n.success("文件上传成功")},w=()=>{n.error("文件上传失败")},B=u=>{console.log("文件已移除:",u)},U=async()=>{if(m.value)try{await m.value.validate(),p.value=!0,await b.createOrder(l.value),n.success("订单创建成功"),_.push("/orders")}catch(u){u!=="cancel"&&n.error("订单创建失败")}finally{p.value=!1}},C=()=>{L.confirm("确定要取消创建订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.push("/orders")}).catch(()=>{})};return(u,e)=>{const c=s("el-input"),a=s("el-form-item"),v=s("el-input-number"),f=s("el-button"),P=s("el-upload"),k=s("el-form"),M=s("el-card");return T(),O("div",A,[t(M,null,{header:r(()=>e[6]||(e[6]=[d("div",{class:"card-header"},[d("span",null,"创建新订单")],-1)])),default:r(()=>[t(k,{ref_key:"formRef",ref:m,model:l.value,rules:y.value,"label-width":"120px",class:"order-form"},{default:r(()=>[t(a,{label:"客户名称",prop:"customerName"},{default:r(()=>[t(c,{modelValue:l.value.customerName,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.customerName=o),placeholder:"请输入客户名称"},null,8,["modelValue"])]),_:1}),t(a,{label:"产品名称",prop:"productName"},{default:r(()=>[t(c,{modelValue:l.value.productName,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.productName=o),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),t(a,{label:"数量",prop:"quantity"},{default:r(()=>[t(v,{modelValue:l.value.quantity,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.quantity=o),min:1,max:9999,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(a,{label:"单价",prop:"unitPrice"},{default:r(()=>[t(v,{modelValue:l.value.unitPrice,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.unitPrice=o),min:0,precision:2,step:.1,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(a,{label:"总价"},{default:r(()=>[d("span",D,"¥"+R(x.value.toFixed(2)),1)]),_:1}),t(a,{label:"设计文件",prop:"files"},{default:r(()=>[t(P,{"file-list":l.value.files,"onUpdate:fileList":e[4]||(e[4]=o=>l.value.files=o),action:"/api/orders/files",headers:V,"before-upload":N,"on-success":q,"on-error":w,"on-remove":B,multiple:"",limit:5},{tip:r(()=>e[8]||(e[8]=[d("div",{class:"el-upload__tip"}," 支持上传设计图纸、工艺说明等文件，单个文件不超过10MB ",-1)])),default:r(()=>[t(f,{type:"primary"},{default:r(()=>e[7]||(e[7]=[g("上传文件")])),_:1})]),_:1},8,["file-list"])]),_:1}),t(a,{label:"备注",prop:"notes"},{default:r(()=>[t(c,{modelValue:l.value.notes,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.notes=o),type:"textarea",rows:4,placeholder:"请输入订单备注信息"},null,8,["modelValue"])]),_:1}),t(a,null,{default:r(()=>[t(f,{type:"primary",onClick:U,loading:p.value},{default:r(()=>e[9]||(e[9]=[g(" 创建订单 ")])),_:1},8,["loading"]),t(f,{onClick:C},{default:r(()=>e[10]||(e[10]=[g("取消")])),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}}),G=z(F,[["__scopeId","data-v-642715ec"]]);export{G as default};
