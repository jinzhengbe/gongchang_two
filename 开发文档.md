# 开发文档

## 项目说明
本文档用于记录项目的开发过程和重要信息。

## API 文档

### 订单布料管理 API

#### 添加布料到订单接口

##### 接口说明
创建新布料并自动关联到指定订单，一步完成布料创建和订单关联操作。

##### 请求信息
- 请求方法：POST
- 请求路径：/api/orders/{orderId}/add-fabric
- 认证要求：需要 Bearer Token（设计师或供应商权限）
- 请求头：
  ```
  Content-Type: application/json
  Authorization: Bearer <your_token>
  ```

##### 请求参数
- orderId: 订单ID（路径参数）

##### 请求体格式
```json
{
  "order_id": 27,
  "name": "优质棉布",
  "composition": "100%棉",
  "color": "白色",
  "width": 150.0,
  "weight": 120.0,
  "category": "棉布",
  "material": "纯棉",
  "pattern": "平纹",
  "price": 25.50,
  "unit": "米",
  "stock": 100,
  "min_order": 5,
  "description": "透气性好，适合夏季服装",
  "tags": "棉布,白色,透气"
}
```

##### 响应信息
```json
{
  "message": "布料添加成功",
  "fabric": {
    "id": 34,
    "name": "优质棉布",
    "category": "棉布",
    "material": "纯棉",
    "color": "白色",
    "pattern": "平纹",
    "weight": 120.0,
    "width": 150.0,
    "price": 25.50,
    "unit": "米",
    "stock": 100,
    "min_order": 5,
    "description": "透气性好，适合夏季服装",
    "status": 1,
    "designer_id": "917851cd-3325-4154-b06d-8e541fb6e4d3",
    "created_at": "2025-06-25T14:40:11.495Z"
  },
  "order_id": 27,
  "association_created": true
}
```

##### 客户端调用示例
```javascript
// 1. 先登录获取token
const loginResponse = await fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'sdf',
    password: '123456'
  })
});
const { token } = await loginResponse.json();

// 2. 添加布料到订单
const addFabricResponse = await fetch(`/api/orders/${orderId}/add-fabric`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${token}`
  },
  body: JSON.stringify({
    order_id: orderId,
    name: '优质棉布',
    composition: '100%棉',
    color: '白色',
    width: 150.0,
    weight: 120.0,
    price: 25.50,
    unit: '米',
    stock: 100,
    min_order: 5,
    description: '透气性好，适合夏季服装'
  })
});

const result = await addFabricResponse.json();
console.log('布料添加成功:', result);
```

##### 错误处理
```json
// 权限错误 (403)
{"error": "用户角色不允许添加布料"}

// 认证错误 (401)
{"error": "用户未认证"}

// 数据验证错误 (400)
{"error": "URL中的订单ID与请求体中的订单ID不一致"}

// 服务器错误 (500)
{"error": "内部服务器错误"}
```

##### 注意事项
1. **数据类型**: `width` 和 `weight` 必须是数字类型，不是字符串
2. **订单ID一致性**: URL中的 `orderId` 必须与请求体中的 `order_id` 一致
3. **自动关联**: 布料创建后会自动关联到订单的 `fabrics` 字段
4. **权限要求**: 只有设计师和供应商可以添加布料
5. **设计师ID**: 如果是设计师操作，会自动设置 `designer_id` 字段

### 工厂列表 API

#### 接口说明
获取工厂列表，支持分页和状态筛选。

#### 请求信息
- 请求方法：GET
- 请求路径：/api/factories
- 请求参数：
  - page: 页码，默认 1
  - page_size: 每页数量，默认 10
  - status: 工厂状态（可选），-1 表示全部，1 表示正常，0 表示停用

#### 响应信息
```json
{
    "code": 0,
    "msg": "success",
    "data": {
        "total": 100,
        "factories": [
            {
                "id": 1,
                "name": "示例工厂",
                "address": "示例地址",
                "description": "工厂描述",
                "status": 1,
                "created_at": "2024-03-14T10:00:00Z",
                "updated_at": "2024-03-14T10:00:00Z"
            }
        ]
    }
}
```

#### 客户端调用示例
```javascript
// 使用 fetch 调用
fetch('/api/factories?page=1&page_size=10&status=1')
  .then(response => response.json())
  .then(data => {
    console.log(data);
  });

// 使用 axios 调用
axios.get('/api/factories', {
  params: {
    page: 1,
    page_size: 10,
    status: 1
  }
})
.then(response => {
  console.log(response.data);
});
```

## 发布流程
项目使用 `publish.sh` 脚本进行一键发布，该脚本会自动完成以下操作：
1. 更新开发文档
2. 更新开发日志
3. 提交代码到 Git 仓库

### 使用方法
1. 确保脚本具有执行权限：
```bash
chmod +x publish.sh
```

2. 执行发布脚本：
```bash
./publish.sh
```

### 脚本功能说明
- 自动记录当前日期
- 更新开发文档和日志
- 自动提交代码到 Git 仓库
- 使用彩色输出提示当前执行的操作

## 更新记录 
## 更新记录 (2025-05-29)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-05-31)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-01)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-08)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-10)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-10)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-12)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-19)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-21)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-23)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-25)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-25)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-26)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-26)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-26)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-27)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新

## 更新记录 (2025-06-28)
- 更新了开发文档
- 更新了开发日志
- 提交了代码更新
